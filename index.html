<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Musik Koffer â€“ Index (Scaffold)</title>
  <style>
    :root {
      --bg: #0b0c0f;
      --card: #12141a;
      --ink: #f2f4f8;
      --ink-dim: #b6beca;
      --line: #1e2230;
      --accent: #7ad2ff;
      --accent-2: #9effa8;
      --pad: 16px;
      --radius: 14px;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --w-nav: 280px;
      --maxw: 1200px;
    }
    * { box-sizing:border-box; }
    html, body { height: 100%; }
    body {
      margin:0; background:var(--bg); color:var(--ink); font: 15px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    header.top {
      position: sticky; top: 0; z-index: 10;
      display:flex; align-items:center; gap:12px; padding:10px var(--pad);
      background: linear-gradient(180deg, rgba(11,12,15,.92), rgba(11,12,15,.75) 60%, rgba(11,12,15,0));
      backdrop-filter: blur(6px);
      border-bottom:1px solid var(--line);
    }
    .brand { font-weight:700; letter-spacing:.3px; }
    .chip {
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); color:var(--ink-dim);
    }
    .wrap { display:flex; min-height: calc(100vh - 52px); }
    nav.side {
      width: var(--w-nav); flex:0 0 var(--w-nav); border-right:1px solid var(--line);
      padding: 18px var(--pad); position: sticky; top:52px; height: calc(100vh - 52px); overflow:auto;
      background:linear-gradient(180deg, #0e1015, #0b0c0f);
    }
    nav .group { margin-bottom: 18px; }
    nav .group h4 { margin:8px 0 8px; font-size:12px; letter-spacing:.12em; color:var(--ink-dim); text-transform:uppercase; }
    nav ul { list-style:none; margin:0; padding:0; display:grid; gap:6px; }
    nav li a {
      display:block; padding:8px 10px; border-radius:10px; color:var(--ink);
      border:1px solid transparent;
    }
    nav li a:hover { background: #12141a; border-color: var(--line); }
    main {
      flex:1; padding: 20px; display:block; max-width: var(--maxw); margin: 0 auto;
    }
    .card {
      background: var(--card); border:1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow);
      margin: 16px 0; overflow:hidden;
    }
    .card .hd {
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 14px var(--pad); border-bottom:1px solid var(--line);
    }
    .card .hd h2 { margin:0; font-size:18px; }
    .card .bd { padding: 16px; }
    .pill { display:inline-block; padding:4px 8px; border-radius:999px; background:#10141d; border:1px solid var(--line); color: var(--ink-dim); font-size:12px; }
    .btn {
      appearance:none; border:1px solid var(--line); background:#10141d; color:var(--ink);
      padding:7px 12px; border-radius:10px; cursor:pointer;
    }
    .btn:hover { border-color:#2a3144; }
    .btn.primary { background: linear-gradient(90deg, #3aa9ff, #76e4a5); color:#0b0c0f; font-weight:700; border:none; }
    .grid {
      display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }
    .kv { display:grid; gap:8px; }
    .kv b { color: var(--ink); }
    .muted { color: var(--ink-dim); }
    .sticky-tools {
      position: sticky; top: 60px; z-index: 5; display:flex; gap:8px; padding: 8px 0; background: linear-gradient(180deg, rgba(11,12,15,0.96), rgba(11,12,15,0));
    }
    .foot {
      margin: 28px 0 60px; color: var(--ink-dim); font-size:12px; text-align:center;
    }
    code.inline { background:#0f141c; border:1px solid var(--line); padding:2px 6px; border-radius:6px; }
    [data-cid]::before {
      content: attr(data-cid);
      position:absolute; top:10px; right:10px; font-size:11px; color:var(--ink-dim);
      background:#0f141c; border:1px solid var(--line); padding:2px 6px; border-radius:999px;
    }
    section { position:relative; scroll-margin-top: 72px; }
  </style>
</head>
<link rel="stylesheet" href="apply-json.css">
<script src="apply-json.js" defer></script>
<script src="scripts/json1-handler.js" defer></script>
<script src="scripts/json2-handler.js" defer></script>


<body>
  <header class="top">
    <div class="brand">ðŸŽ’ Musik Koffer Â· Index</div>
    <span class="chip">Scaffold</span>
    <div style="margin-left:auto" class="sticky-tools">
      <button class="btn" id="btnImport">Import JSON</button>
      <button class="btn" id="btnExport">Export JSON</button>
      <button class="btn" id="btnReload">Neu laden</button>
    </div>
  </header>

  <div class="wrap">
    <nav class="side">
      <div class="group">
        <h4>Ãœbersicht</h4>
        <ul>
          <li><a href="#cover">Cover</a></li>
          <li><a href="#recording">Recording</a></li>
          <li><a href="#midi">MIDI & Routing</a></li>
        </ul>
      </div>
      <div class="group">
        <h4>GerÃ¤te</h4>
        <ul>
          <li><a href="#zoom-l6">ZOOM L-6</a></li>
          <li><a href="#roland-j6">Roland J-6</a></li>
          <li><a href="#roland-t8">Roland T-8</a></li>
          <li><a href="#roland-e4">Roland E-4</a></li>
          <li><a href="#sonicware-tl">Sonicware Texture Lab</a></li>
          <li><a href="#cme-u6">CME U6MIDI Pro</a></li>
        </ul>
      </div>
      <div class="group">
        <h4>AnhÃ¤nge</h4>
        <ul>
          <li><a href="#docs">Dokumente</a></li>
          <li><a href="#changelog">Changelog</a></li>
        </ul>
      </div>
    </nav>

    <main>
      <section id="cover" class="card" data-cid="cover">
        <div class="hd">
          <h2>Cover</h2>
          <span class="pill">Referenz Â· Diese Seite ist ein Scaffold</span>
        </div>
        <div class="bd">
          <p class="muted">Diese HTML ist ein Rahmen. Inhalte & JSON-Automatik folgen.</p>
          <div class="grid">
            <div class="kv"><b>Projekt</b><span>Musik Koffer</span></div>
            <div class="kv"><b>Version</b><span id="ver">v0.1-scaffold</span></div>
          </div>
        </div>
      </section>

      <section id="recording" class="card" data-cid="rec">
        <div class="hd"><h2>Recording Â· Workflows</h2></div>
        <div class="bd">
          <ul>
            <li>Workflow 1 â€“ Rear Line-In Summe â†’ Live Rec â†’ Import in MTR</li>
            <li>Workflow 1A â€“ Texture Lab Sampling/Extrakspur</li>
            <li>Workflow 1B â€“ Mic-In Umschaltung am E-4</li>
          </ul>
        </div>
      </section>

      <section id="midi" class="card" data-cid="midi">
        <div class="hd"><h2>MIDI & Routing</h2></div>
        <div class="bd">
          <p class="muted">Master: T-8 Â· Merger 5 sammelt S-1, T-8, J-6, USB Handy, EZ AG Â· TL: nur Clock.</p>
          <div class="grid">
            <div class="card">
              <div class="hd"><h2>KanÃ¤le</h2></div>
              <div class="bd">
                <ul>
                  <li>S-1 â†’ CH 1</li>
                  <li>EZ AG â†’ CH 2</li>
                  <li>J-6 â†’ CH 6</li>
                  <li>T-8 â†’ CH 8</li>
                </ul>
              </div>
            </div>

            <div class="card">
              <div class="hd"><h2>Ports</h2></div>
              <div class="bd">
                <table style="width:100%;border-collapse:collapse">
                  <thead>
                    <tr>
                      <th style="text-align:left;border-bottom:1px solid #2a3144;padding:6px 8px">Komponente</th>
                      <th style="text-align:left;border-bottom:1px solid #2a3144;padding:6px 8px">Port</th>
                      <th style="text-align:left;border-bottom:1px solid #2a3144;padding:6px 8px">Verbindung</th>
                      <th style="text-align:left;border-bottom:1px solid #2a3144;padding:6px 8px">Bemerkung</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td>Merger #5</td><td>IN 1</td><td>T-8 MIDI OUT â†’ Merger IN1</td><td>Clock-Master Quelle</td></tr>
                    <tr><td>Merger #5</td><td>IN 2</td><td>J-6 MIDI OUT â†’ Merger IN2</td><td>Noten/PC</td></tr>
                    <tr><td>Merger #5</td><td>IN 3</td><td>S-1 MIDI OUT â†’ Merger IN3</td><td>Noten/PC</td></tr>
                    <tr><td>Merger #5</td><td>IN 4</td><td>EZ-AG MIDI OUT â†’ Merger IN4</td><td>CH2</td></tr>
                    <tr><td>Merger #5</td><td>IN 5</td><td>Handy USB â†’ DIN5 â†’ Merger IN5</td><td>Spezialkabel</td></tr>
                    <tr><td>Merger #5</td><td>OUT</td><td>Merger OUT â†’ U6-1 IN1</td><td>Gesammelter Stream</td></tr>

                    <tr><td>U6-1</td><td>IN 2</td><td>L-6 MIDI OUT â†’ U6-1 IN2 (optional)</td><td>Transport/Scenes</td></tr>
                    <tr><td>U6-1</td><td>IN 3</td><td>frei</td><td>Reserve</td></tr>
                    <tr><td>U6-1</td><td>OUT 1</td><td>U6-1 OUT1 â†’ J-6 MIDI IN</td><td>CH6</td></tr>
                    <tr><td>U6-1</td><td>OUT 2</td><td>U6-1 OUT2 â†’ S-1 MIDI IN</td><td>CH1</td></tr>
                    <tr><td>U6-1</td><td>OUT 3</td><td>U6-1 OUT3 â†’ U6-2 IN1</td><td>Loopback-Feed (Parallelverteilung)</td></tr>

                    <tr><td>U6-2</td><td>IN 1</td><td>U6-1 OUT3 â†’ U6-2 IN1</td><td>EmpfÃ¤ngt den Merger-Stream</td></tr>
                    <tr><td>U6-2</td><td>IN 2</td><td>frei</td><td>Reserve</td></tr>
                    <tr><td>U6-2</td><td>IN 3</td><td>frei</td><td>Reserve</td></tr>

                    <tr><td>U6-2</td><td>OUT 1</td><td>U6-2 OUT1 â†’ E-4 MIDI IN</td><td>Sync/PC geblockt</td></tr>
                    <tr><td>U6-2</td><td>OUT 2</td><td>U6-2 OUT2 â†’ Texture Lab MIDI IN</td><td>Clock only (alt. zu J-6 THRU)</td></tr>
                    <tr><td>U6-2</td><td>OUT 3</td><td>U6-2 OUT3 â†’ L-6 MIDI IN</td><td>Start/Stop (optional)</td></tr>

                    <tr><td>J-6</td><td>MIDI THRU</td><td>J-6 THRU â†’ Texture Lab MIDI IN</td><td>PrimÃ¤rer Clock-Pfad (wenn bevorzugt)</td></tr>
                  </tbody>
                </table>

                <div class="grid" style="margin-top:12px">
                  <div class="kv"><b>Kanal-Map</b><span>S-1 â†’ CH 1 Â· EZ-AG â†’ CH 2 Â· J-6 â†’ CH 6 Â· T-8 â†’ CH 8</span></div>
                  <div class="kv"><b>Clock-Master</b><span>T-8 (Start/Stop/Tempo) â†’ via Merger â†’ U6-1 â†’ U6-2 â†’ alle Outs</span></div>
                  <div class="kv"><b>Hinweis</b><span>Texture Lab: Clock via J-6 THRU (empfohlen) oder U6-2 OUT2; TL MIDI OUT ungemerged.</span></div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="hd"><h2>Routing Performance</h2></div>
              <div class="bd">
                <ul>
                  <li><b>Clock Master:</b> T-8 â€“ J-6 & S-1 folgen; Texture Lab nur Clock.</li>
                  <li><b>MIDI-KanÃ¤le:</b> S-1 â†’ CH1 Â· EZ AG â†’ CH2 Â· J-6 â†’ CH6 Â· T-8 â†’ CH8.</li>
                  <li><b>Merger #5:</b> S-1, T-8, J-6, USB Handy, EZ AG â€“ <i>kein</i> TL (Note-In nicht benÃ¶tigt).</li>
                  <li><b>Live-Steuerung:</b> Start/Stop, Program Change (U6 Mapper), Preset-Wechsel.</li>
                </ul>
              </div>
            </div>

            <div class="card">
              <div class="hd"><h2>U6 Routing Profiles</h2><span class="pill">Dual Â· Clock-safe</span></div>
              <div class="bd">
                <ul>
                  <li><b>PC-Policy:</b> nur an J-6 & S-1; an T-8 & E-4 geblockt.</li>
                  <li><b>TL-Pfad:</b> Clock-only (MIDI Realtime) â€“ keine Notes/CC/PC.</li>
                  <li><b>L-6 (optional):</b> empfÃ¤ngt nur Realtime/MMC.</li>
                  <li><b>Remap:</b> Merger-Stream â†’ J-6=CH6, S-1=CH1.</li>
                </ul>
                <p class="muted">Detaillierte Regeln siehe JSON (Import in deine Pipeline/Tools).</p>
              </div>
            </div>

          </div>
        </div>
      </section>

      <section id="zoom-l6" class="card" data-cid="dev-l6">
        <div class="hd"><h2>ZOOM LiveTrak L-6</h2><span class="pill">Mixer Â· Recorder Â· Audio-Interface</span></div>
        <div class="bd">
          <p class="muted">32-Bit Float, Scenes, Sound-Pads, USB 12x4 oder 2x2 (Stereo Mix).</p>
        </div>
      </section>

      <section id="roland-j6" class="card" data-cid="dev-j6">
        <div class="hd"><h2>Roland J-6</h2><span class="pill">Chord Synth Â· Phrase</span></div>
        <div class="bd"><p class="muted">Pattern, Chord-Set, Phrase, USB Audio/MIDI.</p></div>
      </section>

      <section id="roland-t8" class="card" data-cid="dev-t8">
        <div class="hd"><h2>Roland T-8</h2><span class="pill">Drum & Bass</span></div>
        <div class="bd"><p class="muted">Probability, Sub-Steps, Accent, Delay/Reverb.</p></div>
      </section>

      <section id="roland-e4" class="card" data-cid="dev-e4">
        <div class="hd"><h2>Roland E-4</h2><span class="pill">Voice Â· Looper Â· FX</span></div>
        <div class="bd"><p class="muted">Auto Pitch, Harmony, Vocoder, Reverb, Looper.</p></div>
      </section>

      <section id="sonicware-tl" class="card" data-cid="dev-tl">
        <div class="hd"><h2>Sonicware Texture Lab</h2><span class="pill">Granular Synth / FX</span></div>
        <div class="bd"><p class="muted">Grain Engine, CC-Map, Pattern/Sequencer, Sampling.</p></div>
      </section>

      <section id="cme-u6" class="card" data-cid="dev-u6">
        <div class="hd"><h2>CME U6MIDI Pro</h2><span class="pill">2Ã— (Dual Setup)</span></div>
        <div class="bd"><p class="muted">Dual Router: U6-1 verteilt; U6-2 federt TL/E-4/L-6.</p></div>
      </section>

      <section id="docs" class="card" data-cid="docs">
        <div class="hd"><h2>Dokumente (Referenz)</h2></div>
        <div class="bd"><p class="muted">Links & Anchors folgen via JSON2.</p></div>
      </section>

      <section id="changelog" class="card" data-cid="changelog">
        <div class="hd"><h2>Changelog</h2></div>
        <div class="bd">
          <ul id="log"><li>Scaffold erstellt.</li></ul>
        </div>
      </section>

      <div class="foot">Â© Musik Koffer Â· Scaffold</div>
    </main>
  </div>

  <script>
  <div class="toolbar" style="display:flex; gap:8px; margin:12px 0">
  <button id="pickFilesBtn">Dateien wÃ¤hlen (.md/.html)</button>
  <input id="filesInput" type="file" multiple accept=".md,.html,.txt" style="display:none">

  <button id="pickJson2Btn">JSON2 laden</button>
  <input id="json2Input" type="file" accept=".json,application/json" style="display:none">

  <button id="applyBtn">Anwenden</button>
</div>
<div id="output"></div>

<script>
const files = {};      // filename -> text
let json2Obj = null;   // dein JSON2

document.getElementById('pickFilesBtn').addEventListener('click', () =>
  document.getElementById('filesInput').click()
);
document.getElementById('pickJson2Btn').addEventListener('click', () =>
  document.getElementById('json2Input').click()
);

// .md/.html laden
document.getElementById('filesInput').addEventListener('change', async (e) => {
  for (const f of e.target.files) files[f.name] = await f.text();
  info(`Geladen: ${Object.keys(files).join(', ') || 'â€”'}`);
});

// JSON2 laden
document.getElementById('json2Input').addEventListener('change', async (e) => {
  const f = e.target.files[0];
  if (!f) return;
  try { json2Obj = JSON.parse(await f.text()); info(`JSON2: ${f.name}`); }
  catch (err) { error(`JSON2 ungÃ¼ltig: ${err.message}`); }
});

// Anwenden
document.getElementById('applyBtn').addEventListener('click', async () => {
  if (!json2Obj) return error('Bitte zuerst JSON2 laden.');
  if (!Object.keys(files).length) return error('Bitte Ziel-Dateien wÃ¤hlen.');

  // JSON2 -> Engine-Spec (02 â†’ 200 etc. wird hier abgebildet, falls im JSON2 nur â€ž02_*.mdâ€œ steht)
  const spec = toEngineSpec(json2Obj);

  // Apply
  const { applyJson } = window.ApplyJsonEngine;
  const cfg = await fetch('apply-json.config.yml').then(r => r.ok ? r.text() : '');
  const { files: updated, changelog } = applyJson({ json2: spec, files: {...files}, configYAML: cfg });

  // Ausgabe
  const out = [];
  for (const [name, text] of Object.entries(updated)) {
    out.push(`<h3>${escape(name)}</h3><pre>${escape(text)}</pre>`);
  }
  out.push(`<h3>Changelog</h3><pre>${escape(JSON.stringify(changelog, null, 2))}</pre>`);
  document.getElementById('output').innerHTML = out.join('\\n');
});

// ---- 02 -> 200 Mapping + Targets ----
function toEngineSpec(json2){
  // Erwartet: { "DATEINAME.md": { "actions":[ {type, cid|id, content_md} ] }, ... }
  const changes = [];
  for (const [file, block] of Object.entries(json2)) {
    const actions = block.actions || [];
    // Falls im JSON2 nur â€ž02_â€¦â€œ steht, rechne 02 -> 200 um:
    const m = file.match(/^(\d{2})[_-]/);
    const pageId = m ? String(parseInt(m[1],10) * 100) : null;

    actions.forEach((a, i) => {
      const target = { file };             // Datei aus Upload-Dialog
      if (a.cid) target.cid = a.cid;       // <!-- cid:... -->
      if (a.id)  target.id  = a.id;        // {#id} (Heading-ID)

      // Optional: wenn dein JSON2 â€žtargetPageâ€œ = "02" enthÃ¤lt, mappe auf 200:
      if (!target.cid && !target.id && a.targetPage) {
        target.cid = String(parseInt(a.targetPage,10) * 100); // nur als Fallback
      }

      changes.push({
        id: `${pageId || file}#${i+1}`,
        target,
        op: a.type,
        content: a.content_md || a.content || ''
      });
    });
  }
  return { changes };
}

function escape(s){return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));}
function info(msg){ document.getElementById('output').innerHTML = `<div class="apply-json-log">${escape(msg)}</div>`; }
function error(msg){ document.getElementById('output').innerHTML = `<div class="apply-json-log" style="border-color:#ef4444;color:#991b1b">${escape(msg)}</div>`; }
</script>

  
  
    const state = {
      version: document.getElementById('ver').textContent,
      sections: ['cover','recording','midi','zoom-l6','roland-j6','roland-t8','roland-e4','sonicware-tl','cme-u6','docs','changelog'],
      comments: []
    };

    const btnImport = document.getElementById('btnImport');
    const btnExport = document.getElementById('btnExport');
    const btnReload = document.getElementById('btnReload');

    btnExport.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(state, null, 2)], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'json2_export_' + new Date().toISOString().slice(0,19).replace(/[:T]/g,'-') + '.json';
      document.body.appendChild(a); a.click(); a.remove();
    });

    btnImport.addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file'; input.accept = '.json,application/json';
      input.onchange = (e) => {
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const data = JSON.parse(reader.result);
            if (data.version) state.version = data.version;
            if (Array.isArray(data.comments)) state.comments = data.comments;
            document.getElementById('ver').textContent = state.version;
            const log = document.getElementById('log');
            const li = document.createElement('li');
            li.textContent = new Date().toLocaleString() + ': Import OK (' + (state.comments?.length || 0) + ' Kommentare).';
            log.appendChild(li);
            alert('Import abgeschlossen.');
          } catch(err) {
            alert('Fehler beim Import: ' + err.message);
          }
        };
        reader.readAsText(file);
      };
      input.click();
    });

    btnReload.addEventListener('click', () => location.reload());
	
	<link rel="stylesheet" href="apply-json.css">
    src="apply-json.js" defer>
	
	
  </script>
</body>
</html>
