<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Tiage Music Masterplan 25</title>
  <style>
    body {
      font-family: monospace, sans-serif;
      background: #fff;
      color: #000;
      margin: 0;
      padding: 0;
    }
    header {
      background: #111;
      color: white;
      padding: 1rem;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    .button-bar {
      margin-top: 0.5rem;
    }
    .button-bar button {
      margin-right: 8px;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      background: #333;
      color: white;
    }
    .button-bar button:hover {
      background: #666;
    }
    #content {
      padding: 1rem;
    }
    .chapter, .module {
      margin-bottom: 2rem;
    }
    h2 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

<header>
  <h1>Tiage Music Masterplan 25</h1>
  <div class="button-bar">
    <button onclick="exportJson1()">ExpJ1</button>
    <button onclick="exportJson2()">ExpJ2</button>
    <input type="file" id="importFile" style="display:none" onchange="importJson2(event)">
    <button onclick="document.getElementById('importFile').click()">ImpJ2</button>
  </div>
</header>

<div id="content">
  <p>Bitte Kapitel oder Modul wählen…</p>
</div>

<script>
  let chapters = {
    "01_cover.md": "# Cover\n\n## Geräte im Setup\nZoom L-6, Roland J-6, T-8, E-4, S-1, Sonicware Texture Lab, CME U61/U62.",
    "02_geraeteuebersicht.md": "# Geräteübersicht\n\nZoom L-6, Roland J-6, T-8, E-4, S-1, Sonicware Texture Lab, CME U61/U62.",
    "03_first_steps_audio_routing.md": "# First Steps – Audio & Routing\n\n- Audio-Interface Modi: Automatic, MultiTrack\n- Scenes & Sound Pads"
  };

  // --- JSON1 Export (aktueller Stand) ---
  function exportJson1() {
    const blob = new Blob([JSON.stringify(chapters, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    downloadFile(url, "json1-export.json");
  }

  // --- JSON2 Export (nur Platzhalter) ---
  function exportJson2() {
    const json2 = {}; // hier später Kommentare -> Aktionen
    const blob = new Blob([JSON.stringify(json2, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    downloadFile(url, "json2-export.json");
  }

  // --- JSON2 Import (global anwenden) ---
  function importJson2(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const json2 = JSON.parse(e.target.result);
        applyJson2Global(json2);
      } catch (err) {
        alert("Fehler beim Importieren: " + err.message);
      }
    };
    reader.readAsText(file);
  }

  // --- Änderungen global einspielen ---
  function applyJson2Global(json2) {
    let changed = false;

    Object.keys(json2).forEach(fileName => {
      const entry = json2[fileName];
      if (!chapters[fileName]) return;

      entry.actions.forEach(action => {
        if (action.type === "replace") {
          let regex = new RegExp(action.target, "i");
          chapters[fileName] = chapters[fileName].replace(regex, action.content_md);
          changed = true;
        }
        if (action.type === "insert_after") {
          let regex = new RegExp(action.target, "i");
          chapters[fileName] = chapters[fileName].replace(regex, match => match + "\n" + action.content_md);
          changed = true;
        }
      });
    });

    if (changed) {
      document.getElementById("content").innerHTML = "<p><b>Änderungen aus JSON2 wurden angewendet.</b></p><pre>" + JSON.stringify(chapters, null, 2) + "</pre>";
    } else {
      document.getElementById("content").innerHTML = "<p><b>Keine Änderungen aus JSON2 angewendet.</b></p>";
    }
  }

  // --- Helper zum Download ---
  function downloadFile(url, filename) {
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>